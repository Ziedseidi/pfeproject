<div class="list-container">
  <h2>Liste des Affaires</h2>

  <!-- Chargement et erreurs -->
  <div *ngIf="loading" class="loading">Chargement…</div>
  <div *ngIf="errorMsg" class="error">{{ errorMsg }}</div>

  <!-- Table des affaires -->
  <div class="table-wrapper" *ngIf="!loading && !errorMsg">
    <table class="affaires-table">
      <thead>
        <tr>
          <th>Numéro</th>
          <th>Objet</th>
          <th>Degré</th>
          <th>Convocation</th>
          <th>Clôture</th>
          <th>Réception</th>
          <th>Remarques</th>
          <th>Réclamation</th>
          <th>Client</th>
          <th>Vol</th>
         
          <th>Avocat</th>
          <th>Tribunal</th>
          <th>Numéro saisie</th>
          <th>Montant Consignation</th>
          <th>Date Consignation</th>
          <th>Date Recuperation</th>

          <th class="actions-col">Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let a of affaires">
          <td>{{ a.numeroAffaire }}</td>
          <td>{{ a.objet || '—' }}</td>
          <td>{{ a.degreJuridique }}</td>
          <td>{{ a.dateConvocation | date:'shortDate' }}</td>
          <td>{{ a.dateCloture ? (a.dateCloture | date:'shortDate') : '—' }}</td>
          <td>{{ a.clotureApresReception ? 'Oui' : 'Non' }}</td>
          <td>{{ a.remarques || '—' }}</td>
          <td>{{ a.reclamation?.type }}</td>
          <td>{{ a.typeClient }}</td>
          <td>{{ a.numeroVol || '—' }}</td>
          
          <td>
            {{ a.avocat?.nom || '—' }}
            {{ a.avocat?.prenom || '' }}
          </td>
          
          <td>{{ a.tribunal?.nom || '—' }}</td>
          <td>
            <span *ngFor="let s of a.saisies; let last = last">
              {{ s.numeroSaisie }}<span *ngIf="!last">, </span>
            </span>
            <span *ngIf="!a.saisies || a.saisies.length === 0">—</span>
          </td>
          <td>{{ a.consignment?.montant || '—' }} TND</td>
          <td>
            {{ a.consignment?.dateConsignation ? (a.consignment.dateConsignation | date:'shortDate') : 'En cours' }}
          </td>
          <td>
            {{ a.consignment?.dateRecuperation? (a.consignment.dateRecuperation| date:'shortDate') : 'En cours' }}
          </td>
                    <td class="actions">
            <button class="btn edit" (click)="onEdit(a._id)">
              <i class="fas fa-pen"></i> Modifier
            </button>
            <button class="btn delete" (click)="onDelete(a._id)">
              <i class="fas fa-trash-alt"></i> Supprimer
            </button>
            <button class="btn assign" (click)="onAssign(a._id)">
              <i class="fas fa-user-check"></i> Assigner Avocat
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Modal pour l'assignation d'avocat -->
  <div class="overlay" *ngIf="showModal"></div>

  <div *ngIf="showModal" class="modal">
    <div class="modal-content">
      <h3>Avocats Éligibles</h3>
      
      <div *ngIf="modalError" class="modal-error">
        {{ modalError }}
      </div>
      
      <!-- Affichage de l'état de chargement -->
      <div *ngIf="modalLoading" class="loading-message">
        <p>Chargement...</p>
      </div>
  
      <ul *ngIf="!modalLoading">
        <li *ngFor="let avocat of avocatsEligibles">
          <span>{{ avocat.utilisateur.nom }} {{ avocat.utilisateur.prenom }} - {{ avocat.degreJuridiction }}</span>
          <button class="btn assign-btn" (click)="assignerAvocat(avocat.utilisateur._id)">Assigner</button>
        </li>
      </ul>
    
      <button class="btn modal-close-btn" (click)="fermerModal()">Fermer</button>
    </div>
  </div>
</div>
